<!DOCTYPE html>
<html lang="en">
<head>
    <title>Openfire: Upgrade Guide</title>
    <link href="style.css" rel="stylesheet" type="text/css">
</head>
<body>

<article>

    <header>
        <img src="images/header_logo.gif" alt="Openfire Logo" />
        <h1>Upgrade Guide</h1>
    </header>

    <nav>
        <a href="index.html">&laquo; Back to documentation index</a>
    </nav>

    <section id="intro">

        <h2>Introduction</h2>

        <p>
            Upgrading Openfire is almost as easy as installing Openfire from scratch. As part of the upgrade process
            it is highly recommended to backup your current installation and database. Having backups will let you
            easily rollback to a previous state and ensure that you have not lost vital information. The rest of
            the document describes the common steps to perform a successful upgrade.
        </p>
        <p>
            The new version of Openfire will be installed over the existing version and all settings and data will be retained.
        </p>

    </section>

    <section>

        <h2>Standard Upgrade</h2>

        <section>

            <h3>Windows EXE</h3>

            <ol>
                <li>Stop Openfire (when using a service, stop it manually).</li>
                <li>Backup the Openfire installation directory. The default is <code>C:\Program Files\Openfire</code></li>
                <li>Backup the Openfire database. Note that the embedded database is backed up in step 2.</li>
                <li>Run the installer for the new version of Openfire (note that the installer MUST point to the base installation directory of the previous version).</li>
                <li>Complete the installer process.</li>
                <li>Start Openfire (when using a service, start it manually).</li>
            </ol>
            <p><b>Since 4.1.5 the installer will stop and reinstall the service and then start it again automatically.</b></p>

        </section>

        <section>

            <h3>Windows EXE (upgrading from x86 to x64 version)</h3>

            <ol>
                <li>(fastest option) When running the x64 installer point it to the current installation folder of Openfire (by default <code>C:\Program files (x86)\Openfire</code>). If you have Openfire service installed (version prior 4.1.5), stop it first. During the installation it will install/reinstall the service and on the last step you will have to choose whether to run it.</li>
                <li>(safest option) When running the x64 installer point it to a new installation folder (by default <code>C:\Program Files\Openfire</code>). If you have Openfire service installed (version prior 4.1.5), stop it first. During the installation it will install/reinstall the service. On the last step check not to start the service. Copy the <code>/conf</code>, <code>/embedded-db</code> (if using this database), <code>/plugins</code>, <code>/resources/security</code> from the old installation folder to the new one. Manually start the services via Services control page.</li>
            </ol>

            <p>The upgrade guide has been tested against 4.1.4 and newer versions. It should work for older versions, but the results may be different for very old versions. You won't have to stop the service before the upgrade since the version 4.1.5. It will stop and reinstall it automatically.</p>

        </section>

        <section>

            <h3>RPM - RedHat based Linux systems (RHEL, AlmaLinux, Fedora, Rocky Linux, etc)</h3>
            <ol>
                <li>Stop Openfire.</li>
                <li>Backup the Openfire installation directory.</li>
                <li>Backup the Openfire database. Note that the embedded database is backed up in step 2.</li>
                <li>Install the new RPM. Execute <code>rpm -Uvf openfire-*.rpm</code> to update your current install</li>
                <li>Start Openfire.</li>
            </ol>
            <p>
                Remember that the server can be started in manual or automatic mode. Execute <code>/opt/openfire/bin/openfire.sh</code>
                to start in manual mode (in foreground) or execute <code>systemctl restart openfire</code> to start the server as a service (in background).
                Execute <code>systemctl stop openfire</code> to stop the server's service.
            </p>

            <section>

                <h4>Things to note</h4>
                <ul>
                    <li>The new RPM installs Openfire as a service. That means that the server will be started when the OS is started and the server is stopped upon shutdown.</li>
                    <li><code>/opt/openfire/bin/openfire</code> no longer exists. It was a start/stop script generated by Install4j. Since we are no longer using Install4j, it needed to go. Instead, we now have a more standard SystemD service, use <code>systemctl restart</code> to start it.</li>
                    <li><code>/etc/sysconfig/openfire</code> can now be used to 'tweak' things, like paths and such. See the file for more information.</li>
                    <li>The entire directory tree is owned by daemon now. We ditched the need for a new user and are sticking with a standard unix system account. The RPM will take care of owning everything as you install it.</li>
                    <li>Beyond having <code>/etc/init.d/openfire</code> to stop and start openfire, it has chkconfig compatible tags in it and is automatically added via the rpm so that openfire should start up as your server starts up.</li>
                    <li>The <code>/etc/init.d/openfire</code> should not be used directly but called with a SystemD wrapper via <code>systemctl</code> command. The init script is diffuclt to maintain and eventually it will be replaced with the SystemD unit. See the <a hre="https://igniterealtime.atlassian.net/browse/OF-3070">issue ticket</a> for details</li>
                    <li>The RPM will no longer overwrite: <code>conf/openfire.xml</code>, <code>resources/security/keystore</code> or <code>resources/security/truststore</code>.</li>
                </ul>

            </section>

        </section>

        <section>

            <h3>Mac OS X DMG</h3>
            <ol>
                <li>Stop Openfire.</li>
                <li>Backup the Openfire installation directory. The default is <code>/usr/local/openfire</code>.</li>
                <li>Backup the Openfire database. Note that the embedded database is backed up in step 2.</li>
                <li>Open the installer for the new version of Openfire.</li>
                <li>Complete the installer process.</li>
            </ol>

        </section>

        <section>

            <h3>ZIP or TAR.GZ</h3>
            <ol>
                <li>Stop Openfire.</li>
                <li>Backup the Openfire installation directory. This step is critical because the data will be overwritten with the new .tar.gz/zip install.</li>
                <li>Backup the Openfire database. Note that the embedded database is inside the installation directory and is backed up in step 2.</li>
                <li>Wipe out the contents of the Openfire installation directory (all folders and files).</li>
                <li>Extract the .tar.gz/zip file into the installation directory.</li>
                <li>Copy the <code>conf</code> directory from the backup to the installation directory.</li>
                <li>Copy the <code>embedded-db</code> directory from the backup to the installation directory.</li>
                <li>Copy the <code>enterprise</code> directory from the backup to the installation directory, if it exists.</li>
                <li>Copy the <code>plugins</code> directory from the backup to the installation directory except for _plugins/admin_.</li>
                <li>Copy modified files located in <code>resources/security</code> from the backup to the installation directory.</li>
                <li>Start Openfire</li>
            </ol>

        </section>

    </section>

    <section>
        <h2>Special Upgrade cases</h2>

        <p>
            There are some special occasions where some manual intervention is needed while performing the upgrade process. This is
            usually the case when some mayor refactoring work was done that requires complex upgrade operations. However, this is
            not a common case in Openfire (e.g. this happened twice since 2003). Below you will find the upgrade steps to follow
            for these special occasions:
        </p>
        <ul>
            <li><a href="wildfire-openfire-upgrade.html">Wildfire to Openfire Upgrade Guide</a></li>
            <li><a href="wildfire-ent-3_2_0-upgrade.html">Upgrade guide to Wildfire Enterprise 3.2.0</a></li>
        </ul>

    </section>

    <footer>
        <p>
            An active support community for Openfire is available at
            <a href="https://discourse.igniterealtime.org">https://discourse.igniterealtime.org</a>.
        </p>
    </footer>

</article>

</body>
</html>
